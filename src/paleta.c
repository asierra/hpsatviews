/*
 * Definición de la paleta de colores de arcoiris interna.
 * 
 * Copyright (c) 2025-2026  Alejandro Aguilar Sierra (asierra@unam.mx)
 * Labotatorio Nacional de Observación de la Tierra, UNAM
 */
#include "paleta.h"


PaletaData atmosrainbow[257] = {
    { 170.00, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 170.81, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 171.62, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 172.44, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 173.25, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 174.06, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 174.88, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 175.69, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 176.50, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 177.31, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 178.12, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 178.94, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 179.75, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 180.56, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 181.38, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 182.19, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 183.00, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 183.81, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 184.62, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 185.44, 0.498039, 0.000000, 0.498039, 1.000000 },
    { 186.25, 0.549020, 0.050980, 0.529412, 1.000000 },
    { 187.06, 0.600000, 0.098039, 0.556863, 1.000000 },
    { 187.88, 0.647059, 0.149020, 0.588235, 1.000000 },
    { 188.69, 0.698039, 0.200000, 0.615686, 1.000000 },
    { 189.50, 0.749020, 0.250980, 0.647059, 1.000000 },
    { 190.31, 0.800000, 0.298039, 0.678431, 1.000000 },
    { 191.12, 0.850980, 0.349020, 0.705882, 1.000000 },
    { 191.94, 0.898039, 0.400000, 0.737255, 1.000000 },
    { 192.75, 0.949020, 0.447059, 0.764706, 1.000000 },
    { 193.56, 1.000000, 0.498039, 0.796078, 1.000000 },
    { 194.38, 0.901961, 0.901961, 0.901961, 1.000000 },
    { 195.19, 0.803922, 0.803922, 0.803922, 1.000000 },
    { 196.00, 0.701961, 0.701961, 0.701961, 1.000000 },
    { 196.81, 0.603922, 0.603922, 0.603922, 1.000000 },
    { 197.62, 0.501961, 0.501961, 0.501961, 1.000000 },
    { 198.44, 0.403922, 0.403922, 0.403922, 1.000000 },
    { 199.25, 0.301961, 0.301961, 0.301961, 1.000000 },
    { 200.06, 0.203922, 0.203922, 0.203922, 1.000000 },
    { 200.88, 0.101961, 0.101961, 0.101961, 1.000000 },
    { 201.69, 0.000000, 0.000000, 0.000000, 1.000000 },
    { 202.50, 0.101961, 0.000000, 0.000000, 1.000000 },
    { 203.31, 0.200000, 0.000000, 0.000000, 1.000000 },
    { 204.12, 0.301961, 0.000000, 0.000000, 1.000000 },
    { 204.94, 0.400000, 0.000000, 0.000000, 1.000000 },
    { 205.75, 0.501961, 0.000000, 0.000000, 1.000000 },
    { 206.56, 0.600000, 0.000000, 0.000000, 1.000000 },
    { 207.38, 0.701961, 0.000000, 0.000000, 1.000000 },
    { 208.19, 0.800000, 0.000000, 0.000000, 1.000000 },
    { 209.00, 0.901961, 0.000000, 0.000000, 1.000000 },
    { 209.81, 1.000000, 0.000000, 0.000000, 1.000000 },
    { 210.62, 1.000000, 0.101961, 0.000000, 1.000000 },
    { 211.44, 1.000000, 0.200000, 0.000000, 1.000000 },
    { 212.25, 1.000000, 0.301961, 0.000000, 1.000000 },
    { 213.06, 1.000000, 0.400000, 0.000000, 1.000000 },
    { 213.88, 1.000000, 0.501961, 0.000000, 1.000000 },
    { 214.69, 1.000000, 0.600000, 0.000000, 1.000000 },
    { 215.50, 1.000000, 0.701961, 0.000000, 1.000000 },
    { 216.31, 1.000000, 0.800000, 0.000000, 1.000000 },
    { 217.12, 1.000000, 0.901961, 0.000000, 1.000000 },
    { 217.94, 1.000000, 1.000000, 0.000000, 1.000000 },
    { 218.75, 0.901961, 1.000000, 0.000000, 1.000000 },
    { 219.56, 0.800000, 1.000000, 0.000000, 1.000000 },
    { 220.38, 0.701961, 1.000000, 0.000000, 1.000000 },
    { 221.19, 0.600000, 1.000000, 0.000000, 1.000000 },
    { 222.00, 0.501961, 1.000000, 0.000000, 1.000000 },
    { 222.81, 0.400000, 1.000000, 0.000000, 1.000000 },
    { 223.62, 0.301961, 1.000000, 0.000000, 1.000000 },
    { 224.44, 0.200000, 1.000000, 0.000000, 1.000000 },
    { 225.25, 0.101961, 1.000000, 0.000000, 1.000000 },
    { 226.06, 0.000000, 1.000000, 0.000000, 1.000000 },
    { 226.88, 0.000000, 0.917647, 0.039216, 1.000000 },
    { 227.69, 0.000000, 0.835294, 0.074510, 1.000000 },
    { 228.50, 0.000000, 0.749020, 0.113725, 1.000000 },
    { 229.31, 0.000000, 0.666667, 0.149020, 1.000000 },
    { 230.12, 0.000000, 0.584314, 0.188235, 1.000000 },
    { 230.94, 0.000000, 0.501961, 0.227451, 1.000000 },
    { 231.75, 0.000000, 0.415686, 0.262745, 1.000000 },
    { 232.56, 0.000000, 0.333333, 0.301961, 1.000000 },
    { 233.38, 0.000000, 0.250980, 0.337255, 1.000000 },
    { 234.19, 0.000000, 0.168627, 0.376471, 1.000000 },
    { 235.00, 0.000000, 0.082353, 0.411765, 1.000000 },
    { 235.81, 0.000000, 0.000000, 0.450980, 1.000000 },
    { 236.62, 0.000000, 0.000000, 0.450980, 1.000000 },
    { 237.44, 0.000000, 0.050980, 0.478431, 1.000000 },
    { 238.25, 0.000000, 0.101961, 0.505882, 1.000000 },
    { 239.06, 0.000000, 0.149020, 0.533333, 1.000000 },
    { 239.88, 0.000000, 0.200000, 0.560784, 1.000000 },
    { 240.69, 0.000000, 0.250980, 0.588235, 1.000000 },
    { 241.50, 0.000000, 0.301961, 0.615686, 1.000000 },
    { 242.31, 0.000000, 0.349020, 0.643137, 1.000000 },
    { 243.12, 0.000000, 0.400000, 0.670588, 1.000000 },
    { 243.94, 0.000000, 0.450980, 0.698039, 1.000000 },
    { 244.75, 0.000000, 0.501961, 0.725490, 1.000000 },
    { 245.56, 0.000000, 0.549020, 0.752941, 1.000000 },
    { 246.38, 0.000000, 0.600000, 0.780392, 1.000000 },
    { 247.19, 0.000000, 0.650980, 0.807843, 1.000000 },
    { 248.00, 0.000000, 0.701961, 0.835294, 1.000000 },
    { 248.81, 0.000000, 0.749020, 0.862745, 1.000000 },
    { 249.62, 0.000000, 0.800000, 0.890196, 1.000000 },
    { 250.44, 0.000000, 0.850980, 0.917647, 1.000000 },
    { 251.25, 0.000000, 0.901961, 0.945098, 1.000000 },
    { 252.06, 0.000000, 0.949020, 0.972549, 1.000000 },
    { 252.88, 0.000000, 1.000000, 1.000000, 1.000000 },
    { 253.69, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 254.50, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 255.31, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 256.12, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 256.94, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 257.75, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 258.56, 1.000000, 1.000000, 1.000000, 1.000000 },
    { 259.38, 0.996078, 0.996078, 0.996078, 0.800000 },
    { 260.19, 0.988235, 0.988235, 0.988235, 0.789744 },
    { 261.00, 0.976471, 0.976471, 0.976471, 0.779487 },
    { 261.81, 0.968627, 0.968627, 0.968627, 0.769231 },
    { 262.62, 0.956863, 0.956863, 0.956863, 0.758974 },
    { 263.44, 0.949020, 0.949020, 0.949020, 0.748718 },
    { 264.25, 0.937255, 0.937255, 0.937255, 0.738462 },
    { 265.06, 0.929412, 0.929412, 0.929412, 0.728205 },
    { 265.88, 0.917647, 0.917647, 0.917647, 0.717949 },
    { 266.69, 0.909804, 0.909804, 0.909804, 0.707692 },
    { 267.50, 0.898039, 0.898039, 0.898039, 0.697436 },
    { 268.31, 0.886275, 0.886275, 0.886275, 0.687179 },
    { 269.12, 0.878431, 0.878431, 0.878431, 0.676923 },
    { 269.94, 0.866667, 0.866667, 0.866667, 0.666667 },
    { 270.75, 0.858824, 0.858824, 0.858824, 0.656410 },
    { 271.56, 0.847059, 0.847059, 0.847059, 0.646154 },
    { 272.38, 0.839216, 0.839216, 0.839216, 0.635897 },
    { 273.19, 0.827451, 0.827451, 0.827451, 0.625641 },
    { 274.00, 0.819608, 0.819608, 0.819608, 0.615385 },
    { 274.81, 0.807843, 0.807843, 0.807843, 0.605128 },
    { 275.62, 0.796078, 0.796078, 0.796078, 0.594872 },
    { 276.44, 0.788235, 0.788235, 0.788235, 0.584615 },
    { 277.25, 0.776471, 0.776471, 0.776471, 0.574359 },
    { 278.06, 0.768627, 0.768627, 0.768627, 0.564103 },
    { 278.88, 0.756863, 0.756863, 0.756863, 0.553846 },
    { 279.69, 0.749020, 0.749020, 0.749020, 0.543590 },
    { 280.50, 0.737255, 0.737255, 0.737255, 0.533333 },
    { 281.31, 0.729412, 0.729412, 0.729412, 0.523077 },
    { 282.12, 0.717647, 0.717647, 0.717647, 0.512821 },
    { 282.94, 0.709804, 0.709804, 0.709804, 0.502564 },
    { 283.75, 0.698039, 0.698039, 0.698039, 0.492308 },
    { 284.56, 0.686275, 0.686275, 0.686275, 0.482051 },
    { 285.38, 0.678431, 0.678431, 0.678431, 0.471795 },
    { 286.19, 0.666667, 0.666667, 0.666667, 0.461538 },
    { 287.00, 0.658824, 0.658824, 0.658824, 0.451282 },
    { 287.81, 0.647059, 0.647059, 0.647059, 0.441026 },
    { 288.62, 0.639216, 0.639216, 0.639216, 0.430769 },
    { 289.44, 0.627451, 0.627451, 0.627451, 0.420513 },
    { 290.25, 0.619608, 0.619608, 0.619608, 0.410256 },
    { 291.06, 0.607843, 0.607843, 0.607843, 0.400000 },
    { 291.88, 0.596078, 0.596078, 0.596078, 0.300000 },
    { 292.69, 0.588235, 0.588235, 0.588235, 0.297143 },
    { 293.50, 0.576471, 0.576471, 0.576471, 0.294286 },
    { 294.31, 0.568627, 0.568627, 0.568627, 0.291429 },
    { 295.12, 0.556863, 0.556863, 0.556863, 0.288571 },
    { 295.94, 0.549020, 0.549020, 0.549020, 0.285714 },
    { 296.75, 0.537255, 0.537255, 0.537255, 0.282857 },
    { 297.56, 0.529412, 0.529412, 0.529412, 0.280000 },
    { 298.38, 0.517647, 0.517647, 0.517647, 0.277143 },
    { 299.19, 0.509804, 0.509804, 0.509804, 0.274286 },
    { 300.00, 0.498039, 0.498039, 0.498039, 0.271429 },
    { 300.81, 0.486275, 0.486275, 0.486275, 0.268571 },
    { 301.62, 0.478431, 0.478431, 0.478431, 0.265714 },
    { 302.44, 0.466667, 0.466667, 0.466667, 0.262857 },
    { 303.25, 0.458824, 0.458824, 0.458824, 0.260000 },
    { 304.06, 0.447059, 0.447059, 0.447059, 0.257143 },
    { 304.88, 0.439216, 0.439216, 0.439216, 0.254286 },
    { 305.69, 0.427451, 0.427451, 0.427451, 0.251429 },
    { 306.50, 0.419608, 0.419608, 0.419608, 0.248571 },
    { 307.31, 0.407843, 0.407843, 0.407843, 0.245714 },
    { 308.12, 0.396078, 0.396078, 0.396078, 0.242857 },
    { 308.94, 0.388235, 0.388235, 0.388235, 0.240000 },
    { 309.75, 0.376471, 0.376471, 0.376471, 0.237143 },
    { 310.56, 0.368627, 0.368627, 0.368627, 0.234286 },
    { 311.38, 0.356863, 0.356863, 0.356863, 0.231429 },
    { 312.19, 0.349020, 0.349020, 0.349020, 0.228571 },
    { 313.00, 0.337255, 0.337255, 0.337255, 0.225714 },
    { 313.81, 0.329412, 0.329412, 0.329412, 0.222857 },
    { 314.62, 0.317647, 0.317647, 0.317647, 0.220000 },
    { 315.44, 0.309804, 0.309804, 0.309804, 0.217143 },
    { 316.25, 0.298039, 0.298039, 0.298039, 0.214286 },
    { 317.06, 0.286275, 0.286275, 0.286275, 0.211429 },
    { 317.88, 0.278431, 0.278431, 0.278431, 0.208571 },
    { 318.69, 0.266667, 0.266667, 0.266667, 0.205714 },
    { 319.50, 0.258824, 0.258824, 0.258824, 0.202857 },
    { 320.31, 0.247059, 0.247059, 0.247059, 0.200000 },
    { 321.12, 0.239216, 0.239216, 0.239216, 0.197143 },
    { 321.94, 0.227451, 0.227451, 0.227451, 0.194286 },
    { 322.75, 0.219608, 0.219608, 0.219608, 0.191429 },
    { 323.56, 0.207843, 0.207843, 0.207843, 0.188571 },
    { 324.38, 0.196078, 0.196078, 0.196078, 0.185714 },
    { 325.19, 0.188235, 0.188235, 0.188235, 0.182857 },
    { 326.00, 0.176471, 0.176471, 0.176471, 0.180000 },
    { 326.81, 0.168627, 0.168627, 0.168627, 0.177143 },
    { 327.62, 0.156863, 0.156863, 0.156863, 0.174286 },
    { 328.44, 0.149020, 0.149020, 0.149020, 0.171429 },
    { 329.25, 0.137255, 0.137255, 0.137255, 0.168571 },
    { 330.06, 0.129412, 0.129412, 0.129412, 0.165714 },
    { 330.88, 0.117647, 0.117647, 0.117647, 0.162857 },
    { 331.69, 0.109804, 0.109804, 0.109804, 0.160000 },
    { 332.50, 0.098039, 0.098039, 0.098039, 0.157143 },
    { 333.31, 0.086275, 0.086275, 0.086275, 0.154286 },
    { 334.12, 0.078431, 0.078431, 0.078431, 0.151429 },
    { 334.94, 0.066667, 0.066667, 0.066667, 0.148571 },
    { 335.75, 0.058824, 0.058824, 0.058824, 0.145714 },
    { 336.56, 0.047059, 0.047059, 0.047059, 0.142857 },
    { 337.38, 0.039216, 0.039216, 0.039216, 0.140000 },
    { 338.19, 0.027451, 0.027451, 0.027451, 0.137143 },
    { 339.00, 0.019608, 0.019608, 0.019608, 0.134286 },
    { 339.81, 0.007843, 0.007843, 0.007843, 0.131429 },
    { 340.62, 0.000000, 0.000000, 0.000000, 0.128571 },
    { 341.44, 0.000000, 0.000000, 0.000000, 0.125714 },
    { 342.25, 0.000000, 0.000000, 0.000000, 0.122857 },
    { 343.06, 0.000000, 0.000000, 0.000000, 0.120000 },
    { 343.88, 0.000000, 0.000000, 0.000000, 0.117143 },
    { 344.69, 0.000000, 0.000000, 0.000000, 0.114286 },
    { 345.50, 0.000000, 0.000000, 0.000000, 0.111429 },
    { 346.31, 0.000000, 0.000000, 0.000000, 0.108571 },
    { 347.12, 0.000000, 0.000000, 0.000000, 0.105714 },
    { 347.94, 0.000000, 0.000000, 0.000000, 0.102857 },
    { 348.75, 0.000000, 0.000000, 0.000000, 0.100000 },
    { 349.56, 0.000000, 0.000000, 0.000000, 0.097143 },
    { 350.38, 0.000000, 0.000000, 0.000000, 0.094286 },
    { 351.19, 0.000000, 0.000000, 0.000000, 0.091429 },
    { 352.00, 0.000000, 0.000000, 0.000000, 0.088571 },
    { 352.81, 0.000000, 0.000000, 0.000000, 0.085714 },
    { 353.62, 0.000000, 0.000000, 0.000000, 0.082857 },
    { 354.44, 0.000000, 0.000000, 0.000000, 0.080000 },
    { 355.25, 0.000000, 0.000000, 0.000000, 0.077143 },
    { 356.06, 0.000000, 0.000000, 0.000000, 0.074286 },
    { 356.88, 0.000000, 0.000000, 0.000000, 0.071429 },
    { 357.69, 0.000000, 0.000000, 0.000000, 0.068571 },
    { 358.50, 0.000000, 0.000000, 0.000000, 0.065714 },
    { 359.31, 0.000000, 0.000000, 0.000000, 0.062857 },
    { 360.12, 0.000000, 0.000000, 0.000000, 0.060000 },
    { 360.94, 0.000000, 0.000000, 0.000000, 0.057143 },
    { 361.75, 0.000000, 0.000000, 0.000000, 0.054286 },
    { 362.56, 0.000000, 0.000000, 0.000000, 0.051429 },
    { 363.38, 0.000000, 0.000000, 0.000000, 0.048571 },
    { 364.19, 0.000000, 0.000000, 0.000000, 0.045714 },
    { 365.00, 0.000000, 0.000000, 0.000000, 0.042857 },
    { 365.81, 0.000000, 0.000000, 0.000000, 0.040000 },
    { 366.62, 0.000000, 0.000000, 0.000000, 0.037143 },
    { 367.44, 0.000000, 0.000000, 0.000000, 0.034286 },
    { 368.25, 0.000000, 0.000000, 0.000000, 0.031429 },
    { 369.06, 0.000000, 0.000000, 0.000000, 0.028571 },
    { 369.88, 0.000000, 0.000000, 0.000000, 0.025714 },
    { 370.69, 0.000000, 0.000000, 0.000000, 0.022857 },
    { 371.50, 0.000000, 0.000000, 0.000000, 0.020000 },
    { 372.31, 0.000000, 0.000000, 0.000000, 0.017143 },
    { 373.12, 0.000000, 0.000000, 0.000000, 0.014286 },
    { 373.94, 0.000000, 0.000000, 0.000000, 0.011429 },
    { 374.75, 0.000000, 0.000000, 0.000000, 0.008571 },
    { 375.56, 0.000000, 0.000000, 0.000000, 0.005714 },
    { 377.00, 0.000000, 0.000000, 0.000000, 0.002857 },
    { 380.00, 0.000000, 0.000000, 0.000000, 0.000000 },
};

#include "image.h"
#include <math.h>

/**
 * Genera una paleta tipo Arcoiris (Blue-to-Red) de tamaño variable.
 */
ColorArray *create_rainbow_color_array(unsigned int size) {
    if (size < 2) size = 2;

    ColorArray *palette = color_array_create(size);
    if (!palette) return NULL;

    for (unsigned int i = 0; i < size-1; i++) {
        // Normalizamos la posición i en el rango [0.0, 1.0]
        float t = (float)i / (float)(size - 1);

        // Lógica HSV: Mapear t=0 (Azul) a t=1 (Rojo)
        // Hue va de 240.0 (Azul) a 0.0 (Rojo)
        float hue = (1.0f - t) * 240.0f;
        
        // Sector del círculo cromático (0 a 4, ya que cortamos en 240º)
        float sector_pos = hue / 60.0f;
        
        // Cálculo de intensidad intermedia (triangular)
        // x es la distancia al "pico" de color más cercano
        float x = 1.0f - fabsf(fmodf(sector_pos, 2.0f) - 1.0f);
        
        uint8_t max = 255;
        uint8_t mid = (uint8_t)(x * 255.0f + 0.5f);
        uint8_t min = 0;

        Color c;

        // Asignación optimizada según sector
        if (hue < 60.0f) {
            c = (Color){.r = max, .g = mid, .b = min};      // Rojo -> Amarillo
        } else if (hue < 120.0f) {
            c = (Color){.r = mid, .g = max, .b = min};      // Amarillo -> Verde
        } else if (hue < 180.0f) {
            c = (Color){.r = min, .g = max, .b = mid};      // Verde -> Cian
        } else {
            c = (Color){.r = min, .g = mid, .b = max};      // Cian -> Azul
        }

        palette->colors[i] = c;
    }
	// For Non Data
	palette->colors[size-1] = (Color){.r = 0, .g = 0, .b = 0};
	
    return palette;
}

ColorArray* atmosrainbow_to_color_array() {
	unsigned int palette_size = 256;
	ColorArray* color_array = color_array_create(palette_size);
    if (!color_array) {
        return NULL;
    }
    for (unsigned int t = 0; t < palette_size; t++) {
        color_array->colors[t].r = (unsigned char)(255.0f * atmosrainbow[t].r);
        color_array->colors[t].g = (unsigned char)(255.0f * atmosrainbow[t].g);
        color_array->colors[t].b = (unsigned char)(255.0f * atmosrainbow[t].b);
    }
	return color_array;
}
